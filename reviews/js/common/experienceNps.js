var GeoLocation=function(e){var t={url:"/reviews/tools/geo/getCityOid",useNavigator:!1};$.extend(t,e);var i=null,n=function(e,n){$.ajax({url:t.url+(e&&n?"?latitude="+encodeURIComponent(e)+"&longitude="+encodeURIComponent(n):""),contentType:"application/json",type:"GET",success:function(e){i=e}})};this.getCityOid=function(){return $.isNumeric(i)?i:null},t.useNavigator&&navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){n(e.coords.latitude,e.coords.longitude)},n):n()},TextCounter=function(e){var t={textareaSelector:"",paragraphSelector:"",buttonSaveSelector:"",maxCharCount:400};$.extend(t,e),$(t.textareaSelector).attr("maxlength",t.maxCharCount),$(t.paragraphSelector).text(t.maxCharCount),$(t.textareaSelector).on("keyup",function(){$(t.paragraphSelector).text(t.maxCharCount-$(this).val().length),$(t.textareaSelector).val().length>0&&""!=$(t.textareaSelector).val().trim()?$(t.buttonSaveSelector).removeClass("-disable"):$(t.buttonSaveSelector).addClass("-disable")}),this.getValue=function(){return $(t.textareaSelector).val()},this.clean=function(){$(t.textareaSelector).val("")}},experienceNps=function(){var e=$(".nps-options"),t=$(".eva-nps"),i=$(".box-gratitude"),n=$(".box-general"),o=n.find(".eva-textarea"),s=$(".box-general .eva-btn"),a="",r={language:"ES",transactionId:"",product:"",hash:"",hideLink:"false",test:"",reviewExists:""},l=function(i){var l="",p="";$.extend(r,i),a="hash="+r.hash+"&transaction_id="+r.transactionId+"&product="+r.product+"&lang="+encodeURIComponent(r.language)+"&reference=thanks","true"==r.test&&(a+="&test"),$(".nps-container").removeClass("eva-hide"),"dataLayer"in window&&(dataLayer.push({event:"system-action",category:"shermanNPSthanks",action:"viewed",label:r.product}),dataLayer.push({event:"system-action",category:r.product+"-thanks-nps",action:"viewed",label:"default"})),e.on("click","li",function(e){p=$(e.currentTarget).clone().children().remove().end().text().trim(),"dataLayer"in window&&(dataLayer.push({event:"user-action",category:"shermanNPSthanks",action:"score",label:p}),dataLayer.push({event:"user-action",category:r.product+"-thanks-nps",action:"score",label:p}));var i="/reviews/experience/editable?"+a;"true"==r.test&&(i+="&test"),t.attr("class","eva-nps"),t.addClass("-selected-"+p),h(i,p),$(".animation-box").attr("style","");var n=$("#love"),o=$("#yay"),s=$("#wow"),l=$("#sad");3>=p?(n.attr("style","display:none"),o.attr("style","display:none"),s.attr("style","display:none"),l.attr("style","")):p>3&&7>p?(n.attr("style","display:none"),o.attr("style",""),s.attr("style","display:none"),l.attr("style","display:none")):p>=7&&10>p?(n.attr("style","display:none"),o.attr("style","display:none"),s.attr("style",""),l.attr("style","display:none")):10==p&&(n.attr("style",""),o.attr("style","display:none"),s.attr("style","display:none"),l.attr("style","display:none"))}),$('input[type="range"]').change(function(){var i=$(this).val();0!=i?e.find("li").eq(i).click():(t.attr("class","eva-nps"),t.addClass("-selected--1"))});var f=new TextCounter({textareaSelector:".box-general .eva-textarea #textarea-large",paragraphSelector:".box-general .eva-textarea .characterCount",buttonSaveSelector:".box-general .eva-btn"});n.on("click",".eva-link",function(){n.hide(),t.removeClass("-general-st")}),$("[name='eva-radio']").on("click",function(e){l=e.currentTarget.value,"otherReason"==l?((f.getValue().length=0||""==f.getValue().trim())&&$(".box-general .eva-btn").addClass("-disable"),o.removeClass("eva-hide").slideDown()):(f.clean(),o.slideUp(),$(".box-general .eva-btn").removeClass("-disable"))}),$(".box-general .eva-btn").on("click",function(e){if(s.hasClass("-disable"))return e.preventDefault(),!1;var i={type:"experience",averageables:{},additives:[],comment:"",cityOid:""};i.cityOid=c.getCityOid(),i.averageables.avgRecommend=10*p,i.additives=[l],""!=f.getValue().trim()&&(i.comment=f.getValue()),n.hide(),t.removeClass("-general-st"),d(i),u(p)})},c=new GeoLocation,u=function(e){"false"!=r.hideLink||"9"!=e&&"10"!=e||("dataLayer"in window&&(dataLayer.push({event:"system-action",category:"shermanNPSthanks",action:"promotors",label:"trustPilot-linkViewed"}),dataLayer.push({event:"system-action",category:r.product+"-thanks-nps",action:"promotors",label:"trustPilot-linkViewed"})),$(".trustpilot-recommend-link").css("display","inline-block"),i.on("click",".eva-link",f))},h=function(e,t){var i={type:"experience",averageables:{}};i.averageables.avgRecommend=10*t,$.ajax({url:window.location.protocol+"//"+window.location.hostname+e,contentType:"application/json",dataType:"json",data:JSON.stringify(i),type:"POST"})},d=function(e){var t="/reviews/experience?"+a;$.ajax({url:window.location.protocol+"//"+window.location.hostname+t,contentType:"application/json",dataType:"json",data:JSON.stringify(e),type:"POST"}),p()},p=function(){i.fadeTo(0,1),t.addClass("-gratitude-st")},f=function(){"dataLayer"in window&&(dataLayer.push({event:"user-action",category:"shermanNPSthanks",action:"promotors",label:"trustPilot-linkClicked"}),dataLayer.push({event:"user-action",category:r.product+"-thanks-nps",action:"promotors",label:"trustPilot-linkClicked"}));var e="";"ES"==r.language?e="https://es.trustpilot.com/evaluate/www.despegar.com":"PT"==r.language?e="https://pt.trustpilot.com/evaluate/decolar.com":"EN"==r.language&&(e="https://www.trustpilot.com/evaluate/us.despegar.com"),window.open(e)};return{init:l}}(); experienceNps.init({ "language": "ES", "transactionId": "5035162002", "product": "HOTEL", "hash": "5392d771fe5389babdcc2fcdea36c90e", "hideLink": "false", "test": "true", "reviewExists": "false" });
